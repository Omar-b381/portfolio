<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reading Article - Omar Badr</title>
  
  <!-- المسار الصحيح: العودة خطوتين للخلف للوصول للمجلد الرئيسي -->
  <link rel="stylesheet" href="../../style.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q56ET619WZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Q56ET619WZ');
  </script>
</head>
<body>

  <header>
    <div class="container">
      <nav>
        <a href="/en/">Home</a>
        <a href="/en/services/">Services</a>
        <a href="/en/portfolio/">Projects</a>
        <a href="/en/blog/" class="active">Blog</a>
        <a href="/en/about/">About</a>
        <a href="/en/contact/">Contact Me</a>
        <a id="language-switcher-link" href="/ar/" class="language-switcher">العربية</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <article class="blog-post" id="post-container"><p>Loading article...</p></article>

    <section class="related-posts-section">
        <h2 class="section-title">Other Articles You Might Like</h2>
        <div class="blog-grid" id="related-posts-container"></div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>© 2025 Omar Badr | All Rights Reserved</p>
    </div>
  </footer>

  <!-- ==================== Corrected JavaScript Code ==================== -->
  <script>
    function displayError(container, title, message) {
        container.innerHTML = `<div class="error-message"><h1>${title}</h1><p>${message}</p></div>`;
    }

    async function fetchPosts() {
        try {
            // المسار للوصول لملف JSON من داخل مجلد المقال
            const response = await fetch('../../blog-posts.json'); 
            if (!response.ok) throw new Error(`Network error: ${response.statusText}`);
            return await response.json();
        } catch (error) {
            console.error('Error fetching blog posts:', error);
            return null;
        }
    }

    function renderPost(post, container) {
        document.title = post.title + ' - Omar Badr';
        const tagsHTML = post.tags.map(tag => `<span>${tag}</span>`).join('');
        let authorHTML = '';
        if (post.author && post.author.name) {
          if (post.author.linkedin) {
            authorHTML = `<span class="post-author"><i class="fas fa-user"></i> By: <a href="${post.author.linkedin}" target="_blank" class="author-link">${post.author.name} <i class="fab fa-linkedin"></i></a></span>`;
          } else {
            authorHTML = `<span><i class="fas fa-user"></i> By: ${post.author.name}</span>`;
          }
        } else {
          authorHTML = `<span class="post-author"><i class="fas fa-user"></i> By: Omar Badr</span>`;
        }
        const postHTML = `
            <header class="post-header">
                <div class="post-card-tags">${tagsHTML}</div>
                <h1 class="post-title">${post.title}</h1>
                <div class="post-meta">
                    ${authorHTML}
                    <span><i class="fas fa-calendar-alt"></i> ${post.date}</span>
                    <span><i class="fas fa-clock"></i> ${post.readTime}</span>
                </div>
            </header>
            <!-- تم تصحيح مسار الصورة -->
            <img src="../../${post.image}" alt="${post.title}" class="post-featured-image">
            <div class="post-content">${post.content}</div>
            <div class="back-to-portfolio">
                 <a href="/en/blog/" class="cta-button secondary">Back to All Articles</a>
            </div>
        `;
        container.innerHTML = postHTML;
    }

    function renderRelatedPosts(allPosts, currentPostId, container) {
        const related = allPosts.filter(p => p.id !== currentPostId && p.date !== 'Soon');
        const shuffled = related.sort(() => 0.5 - Math.random());
        const selectedPosts = shuffled.slice(0, 3);
        if (selectedPosts.length === 0) {
            document.querySelector('.related-posts-section').style.display = 'none';
            return;
        }
        let relatedHTML = '';
        selectedPosts.forEach(post => {
            const tagsHTML = post.tags.map(tag => `<span>${tag}</span>`).join('');
            relatedHTML += `
                <div class="blog-post-card">
                    <!-- تم تصحيح رابط المقال والصورة -->
                    <a href="/en/${post.link}" class="post-card-image-link">
                        <img src="../../${post.image}" alt="${post.title}" class="post-card-image">
                    </a>
                    <div class="post-card-content">
                        <div class="post-card-tags">${tagsHTML}</div>
                        <h3 class="post-card-title"><a href="/en/${post.link}">${post.title}</a></h3>
                        <div class="post-card-meta"><span><i class="fas fa-calendar-alt"></i> ${post.date}</span></div>
                    </div>
                </div>
            `;
        });
        container.innerHTML = relatedHTML;
    }

    document.addEventListener('DOMContentLoaded', async function() {
        const postContainer = document.getElementById('post-container');
        const relatedContainer = document.getElementById('related-posts-container');
        
        // --- الطريقة الجديدة لتحديد المقال من الرابط ---
        const path = window.location.pathname; // Example: /en/posts/ecommerce-growth/
        const pathSegments = path.split('/').filter(segment => segment.length > 0); // ["en", "posts", "ecommerce-growth"]
        const postId = pathSegments[pathSegments.length - 1]; // Extracts "ecommerce-growth"

        // Update language switcher link for this specific post
        const langSwitcher = document.getElementById('language-switcher-link');
        if(langSwitcher) {
            langSwitcher.href = `/ar/posts/${postId}/`;
        }

        if (!postId || pathSegments.indexOf('posts') === -1) {
            displayError(postContainer, 'Error', `No article selected. Please return to the <a href="/en/blog/">blog page</a> and choose an article.`);
            document.querySelector('.related-posts-section').style.display = 'none';
            return;
        }

        const allPosts = await fetchPosts();
        if (!allPosts) {
            displayError(postContainer, 'Loading Error', 'An error occurred while fetching article data.');
            document.querySelector('.related-posts-section').style.display = 'none';
            return;
        }

        const post = allPosts.find(p => p.id === postId);

        if (post) {
            renderPost(post, postContainer);
            renderRelatedPosts(allPosts, postId, relatedContainer);
        } else {
            displayError(postContainer, 'Error 404: Article Not Found', `We could not find the article you are looking for. <a href="/en/blog/">Return to Blog</a>.`);
            document.querySelector('.related-posts-section').style.display = 'none';
        }
    });
  </script>
</body>
</html>