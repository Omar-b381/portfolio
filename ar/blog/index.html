<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>المدونة - عمر بدر</title>
  
  <link rel="stylesheet" href="../../style.css">
  <!-- المسار الصحيح لملف الصفحة الجديد -->
  <link rel="stylesheet" href="blog-page.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q56ET619WZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Q56ET619WZ');
  </script>
</head>
<body>

  <header>
    <div class="container">
      <nav>
        <a href="/ar/">الرئيسية</a>
        <a href="/ar/services/">الخدمات</a>
        <a href="/ar/portfolio/">المشاريع</a>
        <a href="/ar/blog/" class="active">المدونة</a>
        <a href="/ar/about/">عني</a>
        <a href="/ar/start-project/">أبدأ مشروعك</a>
        <a href="/ar/contact/">تواصل معي</a>
        <a href="/en/blog/" class="language-switcher">English</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="blog-hero">
      <h1 class="page-title">مركز رؤى البيانات</h1>
      <p class="page-subtitle">أشارك هنا أفكاري وتحليلاتي وشروحاتي في عالم البيانات. مكان لنتعلم وننمو معًا.</p>
    </section>

    <!-- ===== أدوات التحكم (بحث وفلترة) ===== -->
    <div class="blog-controls">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="ابحث عن مقال...">
            <i class="fas fa-search"></i>
        </div>
        <div class="tags-filter" id="tags-filter-container">
            <!-- سيتم إنشاء الوسوم هنا بواسطة JavaScript -->
        </div>
    </div>

    <!-- ===== المقال المميز ===== -->
    <section class="featured-post-section">
        <h2 class="section-title-alt">أحدث المقالات</h2>
        <div id="featured-post-container">
            <!-- سيتم وضع المقال المميز هنا -->
        </div>
    </section>
    
    <!-- ===== بقية المقالات ===== -->
    <section class="all-posts-section">
        <h2 class="section-title-alt">كل المقالات</h2>
        <div class="blog-grid" id="other-posts-container">
            <!-- سيتم إنشاء بطاقات المقالات هنا -->
        </div>
    </section>
<!-- ===== Newsletter Section (Connected to Brevo) ===== -->
<section id="newsletter-cta" class="newsletter-cta">
    <div class="newsletter-content">
        <h3>ابق على اطلاع</h3>
        <p>اشترك في النشرة الإخبارية الشهرية للحصول على أحدث المقالات والرؤى مباشرة في بريدك الإلكتروني.</p>
        
        <!-- This is YOUR form that the user sees -->
        <form id="custom-newsletter-form" class="newsletter-form">
            <input 
                id="custom-email-input"
                type="email" 
                placeholder="أدخل بريدك الإلكتروني" 
                required
            >
            <button type="submit" class="cta-button">اشترك الآن</button>
        </form>
        <p id="newsletter-status" class="newsletter-status"></p>

        <!-- This is the REAL Brevo form, hidden from the user -->
        <div style="display:none;">
            <iframe id="hidden-brevo-iframe" name="hidden-brevo-iframe"></iframe>
            <form 
                id="real-brevo-form"
                method="POST" 
                action="https://490e2f14.sibforms.com/serve/MUIFACe1fTJui8C7Tjdf74_j4K_C7phYKEuGkAocy0lKQSxzB5bE5OwOL4NVULS4DPVs1LnfPaDhTsvO-zi0134kziKvF9w1H2jz5Aqk47vPkQMFz1ZUG2R07yg0EqEivRhMwLxDLyvr3rZ5Qhif_zIuiYLOxX2sKqWG9mA3gw79bSMt9uyw5L7JWdGDSH0PyzbNE4MKjw7KsuvM"
                target="hidden-brevo-iframe"
            >
                <input type="email" id="brevo-email-input" name="EMAIL" />
                <!-- Add any hidden input fields from Brevo here if they exist -->
                <input type="hidden" name="locale" value="en">
            </form>
        </div>
    </div>
</section>
  </main>

  <footer>
    <div class="container">
      <p>© 2025 عمر بدر | جميع الحقوق محفوظة</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
        // Add this code inside your main DOMContentLoaded event listener

const customForm = document.getElementById('custom-newsletter-form');
const realForm = document.getElementById('real-brevo-form');
const customEmailInput = document.getElementById('custom-email-input');
const brevoEmailInput = document.getElementById('brevo-email-input');
const newsletterStatus = document.getElementById('newsletter-status');
const submitButton = customForm.querySelector('button');

if (customForm) {
    customForm.addEventListener('submit', function(e) {
        e.preventDefault(); // Stop the custom form from submitting

        // 1. Check if the email is valid
        if (!customEmailInput.checkValidity() || customEmailInput.value === '') {
            newsletterStatus.textContent = 'الرجاء إدخال بريد إلكتروني صحيح.';
            newsletterStatus.className = 'newsletter-status error';
            newsletterStatus.style.display = 'block';
            return;
        }

        // 2. Copy the email from your form to the hidden Brevo form
        brevoEmailInput.value = customEmailInput.value;

        // 3. Submit the hidden Brevo form
        realForm.submit();

        // 4. Show a success message to the user immediately
        // We assume success because the submission happens in the background
        newsletterStatus.textContent = 'شكرًا لاشتراكك! لقد تم تسجيلك بنجاح.';
        newsletterStatus.className = 'newsletter-status success';
        newsletterStatus.style.display = 'block';
        
        // 5. Disable the button and clear the input
        submitButton.disabled = true;
        submitButton.textContent = 'تم الاشتراك!';
        customEmailInput.value = '';

        // Optional: Re-enable the button after a few seconds
        setTimeout(() => {
            submitButton.disabled = false;
            submitButton.textContent = 'اشترك الآن';
            newsletterStatus.style.display = 'none';
        }, 5000);
    });
}
        const featuredContainer = document.getElementById('featured-post-container');
        const othersContainer = document.getElementById('other-posts-container');
        const tagsContainer = document.getElementById('tags-filter-container');
        const searchInput = document.getElementById('search-input');
        let allPosts = [];

        // Fetch all posts from the JSON file
        try {
            const response = await fetch('../blog-posts.json');
            if (!response.ok) throw new Error('Network response was not ok');
            allPosts = await response.json();
        } catch (error) {
            console.error('Error fetching blog posts:', error);
            othersContainer.innerHTML = '<p>حدث خطأ أثناء تحميل المقالات.</p>';
            return;
        }

        // --- Helper function to create post HTML ---
        const createPostHTML = (post, isFeatured = false) => {
            const tagsHTML = post.tags.map(tag => `<span>${tag}</span>`).join('');
            let authorHTML = `<span><i class="fas fa-user"></i> بقلم: عمر بدر</span>`;
            if (post.author && post.author.name) {
              authorHTML = `<span><i class="fas fa-user"></i> بقلم: <a href="${post.author.linkedin}" target="_blank" rel="noopener noreferrer" class="author-link">${post.author.name}</a></span>`;
            }

            if (isFeatured) {
                return `
                <div class="featured-post-card">
                    <a href="/ar/${post.link}" class="featured-post-image-link">
                        <img src="../${post.image}" alt="${post.title}" class="featured-post-image">
                    </a>
                    <div class="featured-post-content">
                        <div class="post-card-tags">${tagsHTML}</div>
                        <h3 class="featured-post-title"><a href="/ar/${post.link}">${post.title}</a></h3>
                        <p class="post-card-excerpt">${post.excerpt}</p>
                        <div class="post-card-meta">
                            ${authorHTML}
                            <span><i class="fas fa-calendar-alt"></i> ${post.date}</span>
                            <span><i class="fas fa-clock"></i> ${post.readTime}</span>
                        </div>
                    </div>
                </div>`;
            } else {
                return `
                <div class="blog-post-card">
                    <a href="/ar/${post.link}" class="post-card-image-link">
                        <img src="../${post.image}" alt="${post.title}" class="post-card-image">
                    </a>
                    <div class="post-card-content">
                        <div class="post-card-tags">${tagsHTML}</div>
                        <h3 class="post-card-title"><a href="/ar/${post.link}">${post.title}</a></h3>
                        <div class="post-card-meta">
                            <span><i class="fas fa-calendar-alt"></i> ${post.date}</span>
                            <span><i class="fas fa-clock"></i> ${post.readTime}</span>
                        </div>
                    </div>
                </div>`;
            }
        };

        // --- Function to display posts ---
        const displayPosts = (postsToDisplay) => {
            if (postsToDisplay.length === 0) {
                othersContainer.innerHTML = '<p>لا توجد مقالات تطابق بحثك.</p>';
                featuredContainer.innerHTML = '';
                document.querySelector('.featured-post-section').style.display = 'none';
                return;
            }

            // Separate the first post as featured, rest in the grid
            const [latestPost, ...otherPosts] = postsToDisplay;
            
            featuredContainer.innerHTML = createPostHTML(latestPost, true);
            othersContainer.innerHTML = otherPosts.map(post => createPostHTML(post, false)).join('');
            document.querySelector('.featured-post-section').style.display = 'block';
        };
        
        // --- Function to populate tags filter ---
        const populateTags = () => {
            const allTags = new Set(allPosts.flatMap(post => post.tags));
            let tagsHTML = '<button class="tag-button active" data-tag="all">كل المواضيع</button>';
            allTags.forEach(tag => {
                tagsHTML += `<button class="tag-button" data-tag="${tag}">${tag}</button>`;
            });
            tagsContainer.innerHTML = tagsHTML;
        };

        // --- Initial Load ---
        displayPosts(allPosts);
        populateTags();

        // --- Event Listener for Tags Filter ---
        tagsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('tag-button')) {
                // Update active state
                document.querySelectorAll('.tag-button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                const selectedTag = e.target.getAttribute('data-tag');
                searchInput.value = ''; // Clear search

                if (selectedTag === 'all') {
                    displayPosts(allPosts);
                } else {
                    const filteredPosts = allPosts.filter(post => post.tags.includes(selectedTag));
                    // For filtered view, we will put all results in the main grid
                    featuredContainer.innerHTML = '';
                    document.querySelector('.featured-post-section').style.display = 'none';
                    othersContainer.innerHTML = filteredPosts.map(post => createPostHTML(post, false)).join('');
                }
            }
        });
        
        // --- Event Listener for Search Input ---
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            // Deactivate all tag buttons
            document.querySelectorAll('.tag-button').forEach(btn => btn.classList.remove('active'));

            if (!searchTerm) {
                displayPosts(allPosts);
                document.querySelector('.tag-button[data-tag="all"]').classList.add('active');
                return;
            }
            
            const filteredPosts = allPosts.filter(post => 
                post.title.toLowerCase().includes(searchTerm) || 
                post.excerpt.toLowerCase().includes(searchTerm)
            );
            
            // For search view, we put all results in the main grid
            featuredContainer.innerHTML = '';
            document.querySelector('.featured-post-section').style.display = 'none';
            othersContainer.innerHTML = filteredPosts.map(post => createPostHTML(post, false)).join('');
        });
    });
    
  </script>
</body>
</html>